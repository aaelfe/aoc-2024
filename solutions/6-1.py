import sys
from pathlib import Path

project_root = str(Path(__file__).parent.parent)
sys.path.append(project_root)

from utils.base import script_handler

input = """......#.............#.....................#..#.........................................................#.................#.#......
.................................#.....#............#........................................#.................................#..
..................#.#.....#........#.#...#.....#..............#................#..#....................................#..#.......
.#....#......................#..........................................................................#......#..................
..............#..................#..#............................................#.....#....#.........#...........................
..............#.......#...#.....#....................................................................#...................#........
....................................................#............#....................................#.............#........#....
..........................#....#...................##.............#.#............................................#................
...............#.......#..................................................#....#..............#..##.....##.................#......
....#............#.......##................#......#.........#.#.......#...#......................#...##...........................
#.........................................#.......#.....#......................#.........#......#.................................
.......#.......#........#......#.......................#..........#....#.##.........#......#.....................#.#..............
..........#.....................#.................#................................................................#..............
...........................................#.................................#............#....................................#..
.....................#.....#..........#...................................................###........#............................
.....#.............#....#.................................#.#............##..#......................................#.............
........#....#.................#..................#............................#...#.#.............#..............................
.............................................#.....#.................................#............................................
......................#.#...................#...#...........................#....#..#............#................................
.......#...#.............#................#................#...............................................#...........#..........
............#............................#..............................................#......................#................#.
......#..............................................#......#.................................#..................................#
................#...............................#.....................................................................#......#....
#....#.............##..................................#.......#..............................#....#..............................
...........#..................#.....#...................................#.........#.........................................#.....
.....#........................#.#.............#.#.......................#........#.....................................#........#.
...................................................................................................#..............................
......#...........................#...................................................#....................................##...#.
#..#...............#.....#............................#....................#...................#...............#..................
.......#.........#......##...........................................#.......................#....................................
.................................................................................#....................#.........#.................
................................#............................................#..............#................................#....
.............................#.............#.............#....#............#.#......#............#...........................#....
....................................#....#...........##..........................................................#................
.......#.....................................................................................#...............................#....
.#....#...............#....................#............................#...............#....................#.................#..
......................................#.#....#....#.......................................................#...................#...
....................#.....#..............................#....................#...........................................#.......
...............................................................................................#.........#........................
.........#............#...........................................................................................................
....#..#.....#..................#..........#.........#............##..#...........................................................
....#.................................#.........................................................#...#..........#..................
...................##.....#.....#.#...#..............................#.........#......#......#............#.......................
.................#.....#....#..................................................................................#..............#...
.....#............#........................................................#.........#..............#.......#.....................
...........#...........................................................#...#..............................#.............#........#
............#....#...............#.....#...................................................................#......................
....#........................#..........#.............................#.....#................................#....................
#............#................#....#..............................................................................................
.......##..........#................................................................#.........#..............................##...
..........#.....................................#.................#.........#................................................#.#..
........#....................#...............#.#.................#..#.................#...............#..#.......................#
................................#.............................##.........#.......#...........#....................................
.....#........#....#...............#............##.......................................................#........................
...#..............................#........................................................................................#......
.....#............................................#............#.....#.........#.........................................#........
........................................#......................................#.#.......#.................................#.#....
..#......#..........................#........................................................................#........#.......#...
.#.....#.#..#........#.......#....................................................................................................
...............................................................#........#...#.....................................................
..................#..........#..............................................#..........................#..........................
..............................................................#................#......#....................#......................
..........##.............#...............................................#...#......#......#.............#........................
.#......#........#.......................#...................................................................................#....
.........................#...........................................................................................#.......#....
.......................................#.................................#......................#........................#..#.#..#
.............#................................................#................#.....................#...................#......#.
...#.....................#.................#.........................................#...#..............................#.........
..#....................................#..............#...........#..........................................#....................
......#...........................................................................................................................
........##............................................#.......................................#.#...#..............##.............
.........#...#.........#.........#...........#....................................................................................
.#..#..........................................#.........^..................................#......................#.........#....
..........................#..................................................#..............#..#......#....#.....#..........#....#
.....................................#.......................................................................................#....
.....#.......#...................#.......#...............................#..#...#...........................................#.....
.........#.#........................................................#......#.....#................................................
..#............#.....#.......#..........................#................................#..........#.............#...............
...............................#....#..#...#..#...............#.......................#..........................................#
.........................................#..............#.............#..........................................#................
..........................#..#.........#........................................................................#.................
.......#.....................................#........................#..#.....#..........#...#.........#.........................
............................................................................................#...............................#.....
....................................................................................#.............................................
........#.................#...................................................................#.......#...........................
..#....#......#............#................#.......#...........#......................#..................................##......
...............#................................#.........#.............................#.........................#...............
...................#...#.......................................................#..#....#......................................#...
..........................##.........#..............................#.....##............#.........................................
..............................................................................#...#.............................##.#..............
#..................#..............................#...............................................................................
.....#..........#.........................................................#.......#...........................##.........#........
..##..#..#..........................#...#...#..............................................................#.#....................
..#.#.........................#...........#...............................................#...#...........#.......................
...............................#......................#......................#.#...............................#..................
.......#.........................#....#..................................................#............#.#.........................
.................#.........#.....#.............................................................................#..................
............#.....................................................#.#................#......#.....#..................#............
.#...............#..............................................................................................#................#
.#....#.................................#..#....#......#...........#..........................................#...................
#.#.................................................................................................................#.............
........#..................#..................................................#................#.#...............#......#.........
........#...................#......................#.......#.#...............#....................................................
.................#.#.........#....#....................#...#........#...#...#.....................................................
.........................#...............................#............................#.............#.................#...........
....#...................................#.#.....................#.............#.........##......#........................#........
..................#..#...#........#...#....#........#.............#............#.....#..............#.......................#.....
....#....#......#..#.....................................#...#......#.........................................................#..#
.....................#................#.#..##..............#...................................#...................#.#............
...........................##.#...............##...........#.......................................................#............#.
................#...................................................................#....#.........#........#..........#..........
...#........#...........................#.............#.................##......#.................................................
............#............................................#..............#...#...........................#.........................
.....#...........................#...............#............#...........#.....................................#....#............
...#................#.......#.......................#.......................................................#...............#.....
..........................................#.....#..#........#..........................................#........................#.
........#..................#.........#.....................#....#.......#..................#.............................#......#.
.........#.#........................................................................#................................#.......#....
..........................#.#..........#.........#.........#.......................#.......................................#......
.........#............................#.............#...#.....#......................#......................................#...#.
...#............................#...................#......................................................................#......
............................#..........#..#..#....#................#..........#...............#.........#.....#...................
##...#.........................#...........#.................#..............................#.....................................
....#.................#.......#............#........#.............................................................#.......#......#
............................##.#................#................#.#.............................................................#
.....#.#........................#.............#.................#......#..........#.........................#....................#
..........................................#.........................#.........................#.......#..#..........#.............
....#.#......#...........................#................#...#.........##...............#..................#.....................
...............................................#...#.#...#...#..........#...#........................#......#.....................
....#.......#....................#........#........#......#.................##...................#.....#...#.............#........"""

@script_handler
def main() -> None:
    # Parse input map into 2D grid
    grid = [list(line) for line in input.strip().splitlines()]
    
    # Find starting position and direction of guard (^)
    start_pos = None
    for y in range(len(grid)):
        for x in range(len(grid[0])):
            if grid[y][x] == '^':
                start_pos = (x, y)
                break
        if start_pos:
            break
    
    # Direction vectors for up, right, down, left
    directions = [(0, -1), (1, 0), (0, 1), (-1, 0)]  # (x,y) pairs instead of (y,x)
    curr_dir = 0  # Start facing up (index 0)
    curr_pos = start_pos
    
    # Follow patrol protocol
    visited = set([curr_pos])
    steps = 0
    while True:
        steps += 1
        if steps % 1000 == 0:
            print(f"Steps taken: {steps}, Unique positions visited: {len(visited)}")
            
        # Get position in front of guard
        next_x = curr_pos[0] + directions[curr_dir][0]
        next_y = curr_pos[1] + directions[curr_dir][1]
        
        # Check if guard has left the mapped area
        if (next_y < 0 or next_y >= len(grid) or
            next_x < 0 or next_x >= len(grid[0])):
            break  # Exit loop when guard leaves the area
        
        # Check if position is blocked by obstacle
        if grid[next_y][next_x] == '#':
            # Turn right 90 degrees
            curr_dir = (curr_dir + 1) % 4
        else:
            # Move forward
            curr_pos = (next_x, next_y)
            visited.add(curr_pos)

    print(f"Guard visited {len(visited)} unique positions")

    
if __name__ == "__main__":
    main()